# CUSTOMER AUTHORIZATION SERVER BUILD PIPELINE

resources:
  repositories:
  - repository: self
    trigger: none

variables:
  buildConfiguration: 'Release'
  workingDirectory: '$(System.DefaultWorkingDirectory)/eshop-api/Customer'

pool:
  vmImage: ubuntu-latest

steps:
- task: DotNetCoreCLI@2
  name: Restore
  inputs:
    command: 'restore'
    projects: '$(workingDirectory)/*.sln'
    
- task: DotNetCoreCLI@2          
  displayName: Build
  inputs:
    command: 'build'
    arguments: '--configuration $(buildConfiguration)'
    projects: '$(workingDirectory)/*.sln'

- task: DotNetCoreCLI@2
  displayName: Dotnet Publish
  inputs:
    command: 'publish'
    publishWebProjects: false
    arguments: '--configuration $(buildConfiguration) -o $(Build.ArtifactStagingDirectory)'
    projects: '$(workingDirectory)/src/EShop.Customer.AuthorizationServer/EShop.Customer.AuthorizationServer.csproj'
    
- task: PublishPipelineArtifact@1
  displayName: Publish Pipepile Artifact - Auth Server
  inputs:
    targetPath: '$(Build.ArtifactStagingDirectory)'
    artifact: 'Customer Authorization Server'
    publishLocation: 'pipeline'
    
- task: PublishPipelineArtifact@1
  displayName: Publish Pipepile Artifact -Bicep
  inputs:
    targetPath: '$(workingDirectory)/.azure/'
    artifact: 'Bicep'
    publishLocation: 'pipeline'