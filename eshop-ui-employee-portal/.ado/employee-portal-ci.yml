#EMPLOYEE PORTAL BUILD PIPELINE

resources:
  repositories:
  - repository: self
    trigger: none

variables:
  buildConfiguration: 'production'
  workingDirectory: '$(System.DefaultWorkingDirectory)/eshop-ui-employee-portal'

pool:
  vmImage: ubuntu-latest

steps:
- task: NodeTool@0
  displayName: 'Install Node.js'
  inputs:
    versionSpec: '22.x'

- task: Npm@1
  displayName: 'Install Angular CLI'
  inputs:
    command: 'custom'
    customCommand: 'install -g @angular/cli@18.1.0'

- task: Npm@1
  displayName: 'NPM ci'
  inputs:
    command: 'ci'
    workingDir: '$(workingDirectory)'

- script: |
    cd $(workingDirectory)
    ng build  --configuration $(buildConfiguration)
  displayName: 'Build Angular App'

- task: PublishPipelineArtifact@1
  displayName: 'Publish Angular Artifacts'
  inputs:
    targetPath: '$(workingDirectory)/dist/eshop-ui-employee-portal/browser'
    artifact: 'EmployeePortal'
    publishLocation: 'pipeline'

- task: PublishPipelineArtifact@1
  displayName: Publish Bicep
  inputs:
    targetPath: '$(workingDirectory)/.azure/'
    artifact: 'Bicep'
    publishLocation: 'pipeline'
